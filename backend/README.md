
# Backend API 

The backend of this project implement Express framework and MongoDB to create an API. Written here is list of object structure, API endpoints, and response example, each of which is necessary and sufficient to build the frontend    stack (*\*hmmmm\*, isn't it?*). 

**NOTE:** The default content-type for POST and DELETE is `application/json`. Whilst the GET and DELETE do not have content-type header.

## Worker Object 

A fundamental object that will reappear frequently in the app.  Simply, it describes a general information of each worker. Furthermore, we use worker `name.nick` (nickname) and `cuid` to identify each worker.

#### The Structure
```
 * _id: String
 * name: String
	 * first: String
	 * last: String
	 * nick: String
 * cuid: String
 * tel: String
 * major: String
 * teams: Array
	 * team: String
```

## Session Object

An object that describe a working session created by the committee. The main content comprises the session's date, starting time, ending time, and most of important of all the list of participants. Moreover, each participant will has two special properties called `active` and `suspicious`. The former tells whether the workers confirmed their participation with the committee or not; the latter describe the worker that might have a tendency to cheat the system by confirming participation through friend's devices. 

#### The Structure
```
 * _id: String
 * time: Object
	 * start: Date
	 * end: Date
 * teams: Array
	 * team: String
 * active: Boolean
 * workers: Array
	 * active: Boolean
	 * code: String
	 * suspicious: Boolean
	 * _id: String
	 * worker: Worker
	 * ip: String
	 * machine: String
 * description: String
```

## Authentication Routes

A list of API use to authenticate a connection as an administrator.

#### `POST /api/admin/login`
- Login as an admin
- Body Parameters
	- **password**: a secret string distributed to each member of the committee
- Return a `json` of `jwt` string for next time authentication

## Administrator Routes

The following API is restricted to site administrator and require authentication. 

#### `PUT /api/admin/worker/activate/:sessionID`
- Add a worker to a session
- Path Parameters
	- **sessionID**:  an ID of a session we want to add worker into
- Body Parameters
	- **identifier**: a string generated by the application itself
- Return a simple `HTTP 200` if success 

#### `DELETE /api/admin/worker/:sessionID/:studentID`
- Remove a worker from a session
- Path Parameters
	- **sessionID**:  an ID of a session we want to remove worker from
	- **studentID**: unique 10-digits Chula Student ID
- Return a simple `HTTP 200` if success

#### `DELETE /api/admin/worker/:sessionID/:workerID`
- Remove a worker from a session
- Path Parameters
	- **sessionID**:  an ID of a session we want to remove worker from
	- **workerID**: unique 10-digits Chula Student ID
- Return a simple `HTTP 200` if success

#### `POST /api/admin/sessions`
- Create a new session 
- Body Parameters
	- **teams**: `design`, `finance`, `hr`, `welfare`, `stand`, `show`, or `structure`
	- **date**: the date when the session takes place  in a format of `dd/mm` (month number ranges from 0 to 11). 
	- **start**:  a timestamp in a format of `hh:mm` for example `13:45`
	- **end**: a timestamp, in the same format, after the start time
	- **[note]**: any note for this session
- Return a `json` of **Session Object** of the created session

#### `PUT /api/admin/sessions/:id`
- Update or edit an existing session
- Path Parameters
	- **id**: a unique session ID
- Body Parameters
	- **teams**: `design`, `finance`, `hr`, `welfare`, `stand`, `show`, or `structure`
	- **date**: the date when the session takes place in a format of `dd:mm`
	- **start**:  a timestamp in a format of `hh:mm` for example `13:45`
	- **end**: a timestamp, in the same format, after the start time
	- **[note]**: any note for this session
- Return a `json` of **Session Object** of the new data of edited session 

#### `PUT /api/admin/sessions/:id/[open||close]`
- Open or close an existing session
- Path Parameters
	- **id**: a unique session ID
	- **type**: either `open` or `close`
	- Return a `json` of edited **Session Object** using new data

#### `DELETE /api/admin/sessions/:id`
- Delete an existing session specified by its ID
- Path Parameters
	- **id**: a unique session ID
- Return a `json` of deleted **Session Object**

## Public Routes

Listed below are the list of API that anyone can access without restriction.

#### `GET /api/sessions`
- Return a list of all sessions, of which the structure is specified section

#### `GET /api/sessions/active`
- Return a list of all active sessions, of which the structure is specified section

#### `GET /api/sessions/inactive`
- Return a list of all inactive sessions, of which the structure is specified section

#### `GET /api/sessions/:id`
- Search a session specified by its ID
- Path Parameters
	- **id**: a unique 10-digits Chula Student ID (e.g. `6238034521`)
- Return a `json` of **Session Object**

#### `GET /api/sessions/:studentID([0-9]{10})`
- Get all sessions that the specified student has joined
- Path Parameters
	- **studentID**: a unique 10-digits Chula Student ID (e.g. `6238034521`)
- Return a `json` list of **Session Object** 

#### `GET /api/workers/:sessionID/[active||pending]` 
- Get all students in a specified session (either active or inactive can be specified in the path)
- Path Parameters
	- **sessionID**: a unique session ID
- Return `json` list of workers

#### `POST /api/worker/pend/:sessionID`
- Return an activation code for joining session (this will be used to create QR code).
- Path Parameters
	- **sessionID**: a unique session ID
- Body Parameters
	- **nameNick**: the worker's nick name
	- **studentID**: the worker's 10-digits Chula Student ID
	- **[nameFirst]**: the worker's first name
	- **[nameLast]**: the worker's last name
- Return `json` containing the following key:
	- **identifier**: a code used to generate QR directly 
	
#### `POST /api/worker/pend/:sessionID/:workerID`
- Return an activation code for joining session (this will be used to create QR code).
- Path Parameters
	- **sessionID**: a unique session ID
	- **workerID**: a unique worker ID
- Return `json` containing the following key:
	- **identifier**: a code used to generate QR directly 
